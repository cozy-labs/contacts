// Generated by CoffeeScript 1.8.0
var americano, contactwatch, fs, host, path, port, start;

contactwatch = require('./server/initializers/contactwatch');

path = require('path');

fs = require('fs');

americano = require('americano');

start = function(options, callback) {
  var configPath;
  if (options == null) {
    options = {};
  }
  options.name = 'Contacts';
  if (options.port == null) {
    options.port = 9114;
  }
  options.host = process.env.HOST || "0.0.0.0";
  if (options.root == null) {
    options.root = __dirname;
  }
  configPath = path.join(process.cwd(), 'config.json');
  if (!fs.existsSync(configPath)) {
    fs.writeFileSync(configPath, JSON.stringify({}));
  }
  return americano.start(options, function(app, server) {
    return typeof callback === "function" ? callback(null, app, server) : void 0;
  });
};

if (!module.parent) {
  host = process.env.HOST || '127.0.0.1';
  port = process.env.PORT || 9114;
  start({
    port: port
  }, function(err) {
    if (err) {
      console.log("Initialization failed, not starting");
      console.log(err.stack);
      return process.exit(1);
    }
  });
}

module.exports.start = start;
